<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rename Files - Made By: @085_Teuzinnn</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff4500">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2965/2965301.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root {
            --bg-color: #0f0f0f;
            --container-bg: #1a1a1a;
            --text-color: #e0e0e0;
            --primary-color: #ff4500;
            --primary-hover: #e63e00;
            --border-color: #333333;
            --card-bg: #242424;
            --input-bg: #121212;
            --shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 650px;
            background: var(--container-bg);
            padding: 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin: 0 0 20px 0;
            font-size: 1.8em;
            letter-spacing: -1px;
        }

        h2 {
            font-size: 1.2em;
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
            padding-left: 10px;
            margin: 25px 0 15px 0;
        }

        .input-group {
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9em;
            color: #bbb;
        }

        input[type="text"], 
        input[type="file"], 
        input[type="number"], 
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--input-bg);
            color: #fff;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
        }

        .accordion {
            border: 1px solid var(--border-color);
            border-radius: 10px;
            margin-bottom: 12px;
            overflow: hidden;
            background: var(--card-bg);
        }

        .accordion-header {
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            transition: background 0.2s;
            user-select: none;
        }

        .accordion-header:hover {
            background: #2d2d2d;
        }

        .accordion-header.active {
            background: var(--primary-color);
            color: #fff;
        }

        .accordion-content {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s;
        }

        .accordion-content.open {
            padding: 15px;
            max-height: 1000px;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
            transition: transform 0.1s, background 0.2s;
            margin-top: 10px;
        }

        .btn:active { transform: scale(0.98); }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:disabled {
            background-color: #444;
            cursor: not-allowed;
        }

        .btn-zip {
            background-color: #2ecc71;
            color: white;
        }

        .btn-danger {
            background-color: #c0392b;
            color: white;
        }

        .file-item {
            background: var(--card-bg);
            padding: 15px;
            margin-top: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .old-name { font-size: 0.8em; color: #888; word-break: break-all; }
        .new-name { font-weight: bold; color: var(--primary-color); word-break: break-all; }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .checkbox-item input { width: auto; }

        footer {
            margin-top: 30px;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
        }

        @media (max-width: 480px) {
            .container { padding: 15px; }
            h1 { font-size: 1.5em; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Rename Files</h1>

    <div class="input-group">
        <label>1. CARREGAR ARQUIVOS</label>
        <input type="file" id="file-input" multiple webkitdirectory directory>
        <div id="file-count" style="font-size: 0.8em; margin-top: 8px; color: #888;">Nenhum arquivo selecionado.</div>
    </div>

    <div class="input-group">
        <label>ORDENAR ANTES DE RENOMEAR</label>
        <select id="sort-order">
            <option value="name">Por Nome (A-Z)</option>
            <option value="date-asc">Por Data: Antigos primeiro</option>
            <option value="date-desc">Por Data: Novos primeiro</option>
        </select>
    </div>

    <h2>Dica Resumida</h2>

    <div class="accordion">
        <div class="accordion-header">Sequencial e Data <span>+</span></div>
        <div class="accordion-content">
            <label>Nome Base (Use [seq], [date_mod]):</label>
            <input type="text" id="sequential-name" placeholder="Ex: Viagem_[seq]">
            <div style="display:flex; gap:10px; margin-top:10px">
                <input type="number" id="start-number" value="1" placeholder="Início">
                <input type="number" id="padding-number" value="2" placeholder="Dígitos">
            </div>
            <label style="margin-top:10px">Formato de Data:</label>
            <select id="date-format-select">
                <option value="none">Não usar</option>
                <option value="YYYY-MM-DD">2026-02-11</option>
                <option value="DD-MM-YYYY">11-02-2026</option>
            </select>
        </div>
    </div>

    <div class="accordion">
        <div class="accordion-header">Substituição <span>+</span></div>
        <div class="accordion-content">
            <input type="text" id="find-string" placeholder="Localizar texto">
            <input type="text" id="replace-string" placeholder="Substituir por" style="margin-top:10px">
            <div class="checkbox-item">
                <input type="checkbox" id="use-regex"> <label>Usar Regex</label>
            </div>
        </div>
    </div>

    <div class="accordion">
        <div class="accordion-header">Corte e Ajustes <span>+</span></div>
        <div class="accordion-content">
            <div style="display:flex; gap:10px">
                <input type="number" id="trim-start" placeholder="Cortar Início">
                <input type="number" id="trim-end" placeholder="Cortar Fim">
            </div>
            <input type="text" id="prefix-string" placeholder="Prefixo" style="margin-top:10px">
            <input type="text" id="suffix-string" placeholder="Sufixo" style="margin-top:10px">
        </div>
    </div>

    <div class="accordion">
        <div class="accordion-header">Limpeza e Caixa <span>+</span></div>
        <div class="accordion-content">
            <select id="case-standardization">
                <option value="none">Manter original</option>
                <option value="lower">minúsculas</option>
                <option value="upper">MAIÚSCULAS</option>
                <option value="title">Tipo Título</option>
            </select>
            <div class="checkbox-item">
                <input type="checkbox" id="remove-parentheses"> <label>Remover () e []</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="remove-multiple-spaces"> <label>Limpar espaços extras</label>
            </div>
        </div>
    </div>

    <button id="apply-btn" class="btn btn-primary" disabled>APLICAR REGRAS / PRÉVIA</button>
    <button id="download-zip" class="btn btn-zip" disabled>BAIXAR TUDO (ZIP)</button>
    <button id="clear-btn" class="btn btn-danger">LIMPAR OPÇÕES</button>

    <div id="result-list" style="margin-top: 20px;"></div>
</div>

<footer class="text-center mt-5 text-gray-500 text-sm">
    Made By: <a href="https://instagram.com/085_Teuzinnn" target="_blank" class="text-blue-400 hover:text-blue-300 font-semibold transition duration-200">@085_Teuzinnn</a>
</footer>

<script>
    const fileInput = document.getElementById('file-input');
    const sortOrder = document.getElementById('sort-order');
    const resultList = document.getElementById('result-list');
    const applyBtn = document.getElementById('apply-btn');
    const downloadZip = document.getElementById('download-zip');
    
    let originalFiles = [];
    let processedFiles = [];

    document.querySelectorAll('.accordion-header').forEach(header => {
        header.onclick = () => {
            const content = header.nextElementSibling;
            header.classList.toggle('active');
            content.classList.toggle('open');
        };
    });

    fileInput.onchange = (e) => {
        originalFiles = Array.from(e.target.files);
        document.getElementById('file-count').innerText = `${originalFiles.length} arquivo(s) carregado(s).`;
        applyBtn.disabled = originalFiles.length === 0;
        if(originalFiles.length > 0) processPreview();
    };

    sortOrder.onchange = () => { if(originalFiles.length > 0) processPreview(); };

    function processPreview() {
        let files = [...originalFiles];
        const order = sortOrder.value;

        if(order === 'name') {
            files.sort((a,b) => a.name.localeCompare(b.name));
        } else if(order === 'date-asc') {
            files.sort((a,b) => a.lastModified - b.lastModified);
        } else if(order === 'date-desc') {
            files.sort((a,b) => b.lastModified - a.lastModified);
        }

        const options = {
            baseName: document.getElementById('sequential-name').value,
            start: parseInt(document.getElementById('start-number').value) || 1,
            pad: parseInt(document.getElementById('padding-number').value) || 0,
            dateFmt: document.getElementById('date-format-select').value,
            find: document.getElementById('find-string').value,
            replace: document.getElementById('replace-string').value,
            regex: document.getElementById('use-regex').checked,
            tStart: parseInt(document.getElementById('trim-start').value) || 0,
            tEnd: parseInt(document.getElementById('trim-end').value) || 0,
            prefix: document.getElementById('prefix-string').value,
            suffix: document.getElementById('suffix-string').value,
            case: document.getElementById('case-standardization').value,
            noParen: document.getElementById('remove-parentheses').checked,
            cleanSpace: document.getElementById('remove-multiple-spaces').checked
        };

        resultList.innerHTML = '';
        processedFiles = files.map((f, i) => {
            let name = f.name;
            let ext = '';
            const lastDot = name.lastIndexOf('.');
            if(lastDot !== -1) {
                ext = name.substring(lastDot);
                name = name.substring(0, lastDot);
            }

            if(options.baseName) {
                name = options.baseName;
                if(name.includes('[seq]')) {
                    name = name.replace('[seq]', (i + options.start).toString().padStart(options.pad, '0'));
                } else {
                    name += (i + options.start).toString().padStart(options.pad, '0');
                }
            }

            if(options.dateFmt !== 'none') {
                const d = new Date(f.lastModified);
                const ds = options.dateFmt === 'YYYY-MM-DD' ? 
                    d.toISOString().split('T')[0] : 
                    `${d.getDate().toString().padStart(2,'0')}-${(d.getMonth()+1).toString().padStart(2,'0')}-${d.getFullYear()}`;
                name = name.replace('[date_mod]', ds);
            }

            if(options.tStart > 0) name = name.substring(options.tStart);
            if(options.tEnd > 0) name = name.substring(0, name.length - options.tEnd);

            if(options.noParen) name = name.replace(/[\(\[].*?[\)\]]/g, '');

            if(options.find) {
                const search = options.regex ? new RegExp(options.find, 'g') : options.find;
                name = name.split(search).join(options.replace);
            }

            name = options.prefix + name + options.suffix;

            if(options.case === 'lower') name = name.toLowerCase();
            if(options.case === 'upper') name = name.toUpperCase();
            if(options.case === 'title') name = name.toLowerCase().replace(/\b\w/g, l => l.toUpperCase());

            if(options.cleanSpace) name = name.replace(/\s+/g, ' ').trim();

            const finalName = name + ext;
            
            const div = document.createElement('div');
            div.className = 'file-item';
            div.innerHTML = `<span class="old-name">${f.name}</span><span class="new-name">${finalName}</span>`;
            resultList.appendChild(div);

            return { file: f, newName: finalName };
        });

        downloadZip.disabled = processedFiles.length === 0;
    }

    applyBtn.onclick = processPreview;

    downloadZip.onclick = async () => {
        const zip = new JSZip();
        processedFiles.forEach(item => {
            zip.file(item.newName, item.file);
        });
        const content = await zip.generateAsync({type: "blob"});
        const link = document.createElement('a');
        link.href = URL.createObjectURL(content);
        link.download = "arquivos_renomeados.zip";
        link.click();
    };

    document.getElementById('clear-btn').onclick = () => {
        location.reload();
    };

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js')
            .then(() => console.log("SW OK"))
            .catch(err => console.log("SW ERR", err));
    }
</script>
</body>
</html>